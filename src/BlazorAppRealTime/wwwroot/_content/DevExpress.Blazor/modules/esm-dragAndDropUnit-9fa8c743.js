import"./esm-chunk-eaca7b99.js";import{H as t,ae as e}from"./esm-chunk-dac9ea79.js";import{T as i}from"./esm-chunk-e2d38309.js";import{E as s}from"./esm-chunk-e05effe2.js";class n{constructor(e,i,s,n,o,r){this.isModal=r,this.itemForDrag=e,t(this.itemForDrag),this.container=i,this.GetDropTarget=s,this.clean=!1,this.getZeroPoint=o,n&&(this.dragAnchor=this.itemForDrag.querySelector(n)),this.dragAnchor||(this.dragAnchor=this.itemForDrag),this.cloneForMove=null,this.Reset()}dropEvents(){this.events&&(this.events.Dispose(),this.events=null)}dropTempObject(){this.currentPoint=null,this.startPoint=null,this.cloneForMove&&(this.cloneForMove.parentNode.removeChild(this.cloneForMove),this.cloneForMove=null)}Reset(){if(!this.clean){this.clean=!0,this.dropTempObject(),this.dropEvents(),this.events||(this.events=new s(this));var t=this;this.eventTokenDragStart=this.events.AttachEvent(this.dragAnchor,i.touchMouseDownEventName,(function(t){this.dragTriger(t)})),this.container.size=function(){return g(t.container).size},this.itemForDrag.size=function(){return g(t.itemForDrag).size},this.itemForDrag.location=function(){return g(t.itemForDrag).location},this.contentHeightInt=-1}}Stop(){this.clean=!1,this.dropEvents()}Dispose(){this.dropTempObject(),this.dropEvents(),this.onDragStart=null,this.onDrag=null,this.onDrop=null,this.onDragEndAnimateEnd=null,this.onDragCancel=null,this.itemForDrag=null,this.container=null}get contentHeight(){if(-1===this.contentHeightInt){this.contentHeightInt=0;for(var t=this.scrollContainer.children,e=0;e<t.length;e++)t[e]!==this.cloneForMove&&(this.contentHeightInt+=t[e].getBoundingClientRect().height)}return this.contentHeightInt}get cursor(){return this.cursorPoint}get isScrollActive(){return this.contentHeight!==g(this.scrollContainer).height}get scrollContainer(){if(this.isModal){if(!this._scrollContainer)for(var t=this.container;t!==window&&t.classList;){if(t.classList.contains("modal-body")){this._scrollContainer=t;break}t=t.parentNode}return this._scrollContainer}return this.container}get scrollingCorrection(){return this.isModal&&this.isScrollActive?{y:this.scrollingStart-this.scrollContainer.scrollTop}:{y:0}}dragTriger(t){this.updateCursor(t);var e=this.cursor.clone(),s=null,n=null,o=function(){s.Dispose(),n.Dispose()};return s=this.events.AttachEvent(document,i.touchMouseMoveEventName,(function(i){return this.updateCursor(i),l(e,"-",this.cursor).scalarLength>3&&(o(),this.clean=!1,this.dragStart(t)),i.preventDefault(),!1})),n=this.events.AttachEvent(document,i.touchMouseUpEventName,o),t.preventDefault(),!1}dragStart(t){var s,n;this.itemForDrag&&(this.updateCursor(t),this.eventTokenDragStart.Dispose(),this.cloneForMove=((n=(s=this.itemForDrag).cloneNode(!0)).center=function(){return g(n).center},n.size=function(){return g(n).size},n.style.transition="none",n.style.width=s.offsetWidth+"px",n.style.height=s.offsetHeight+"px",n.style.visibility="hidden",n.classList.add("in-drag"),e(n),n),this.itemForDrag.parentNode.insertBefore(this.cloneForMove,this.itemForDrag),this.onDragStart&&this.onDragStart(this.itemForDrag),this.scrollingStart=this.scrollContainer.scrollTop,this.eventTokenDrag=this.events.AttachEvent(document,i.touchMouseMoveEventName,(function(t){this.drag(t)})),this.eventTokenDragEnd=this.events.AttachEvent(document,i.touchMouseUpEventName,(function(t){this.dragEnd(t)})))}drag(t){if(this.itemForDrag&&this.cloneForMove){this.updateCursor(t),this.scroll(),this.startPoint||(this.currentPoint=this.cursor.clone(),this.cloneForMove.style.visibility="visible",this.startPoint=g(this.cloneForMove).location);var e=l(this.scrollContainer,"-",this.cloneForMove.size());e.width=0,this.currentPoint=this.cursor.LimitByRectangle(e);var i=l(this.currentPoint,"-",this.startPoint,"-",this.scrollingCorrection);this.translateElement(this.cloneForMove,i,0),this.onDrag&&(t.centerOfDraggingObject=this.toRelativeCoord(this.cloneForMove.center()),this.onDrag(this.itemForDrag,t))}}dragEnd(t){if(this.itemForDrag&&this.cloneForMove&&this.startPoint){this.eventTokenDrag.Dispose(),this.eventTokenDragEnd.Dispose();var e=this.GetDropTarget(this.toRelativeCoord(this.cloneForMove.center()));if(e&&this.itemForDrag!==e.item){this.onDrop&&this.onDrop(this.itemForDrag,e.item);var i=l(this.toScreanCoord(e.relativeRect),"-",this.startPoint,"-",this.scrollingCorrection);return this.animateItem(this.cloneForMove,i,(function(){this.cloneForMove&&(this.cloneForMove.style["box-shadow"]="none"),this.onDropAnimationEnd&&this.onDropAnimationEnd(this.itemForDrag,e.item)})),void 0}this.cloneForMove&&this.animateItem(this.cloneForMove,{x:0,y:0},(function(){this.onDragCancel(this.itemForDrag),this.Reset()}))}}scroll(){if(this.isScrollActive){var t=this.scrollContainer.getBoundingClientRect(),e=this.cursor.y+this.cloneForMove.size().height+2-t.bottom;if(e>0)return this.scrollContainer.scrollTop=Math.min(this.scrollContainer.scrollTop+e,this.contentHeight-t.height),void 0;(e=this.cursor.y-2-t.top)<0&&(this.scrollContainer.scrollTop=Math.max(this.scrollContainer.scrollTop+e,0))}}updateCursor(t){this.cursorPoint=new r(this.getClientEventPos(t,"clientX"),this.getClientEventPos(t,"clientY")-this.itemForDrag.size().height/2)}translateElement(t,e,i){var s=t.style.transform;if(0===e.x&&0===e.y&&(s.includes("translate(0px)")||s.includes("translate(0px,0px)")))return!1;t.style.transition="all "+i+"s";var n=["translate(",Math.round(e.x),"px, ",Math.round(e.y),"px)"].join("");return!s.includes(n)&&(t.style.transform=n,!0)}animateItem(t,e,i){var s=null,n=function(){s.Dispose(),i.call(this)};s=this.events.AttachEvent(t,"transitionend",n);var o=this.translateElement(t,e,"0.2");return o||n.call(this),o}toRelativeCoord(t){return l(t,"-",this.getZeroPoint())}toScreanCoord(t){return l(t,"+",this.getZeroPoint())}getClientEventPos(t,e){return void 0!==t[e]?t[e]:void 0!==t.touches&&t.touches[0]&&t.touches[0][e]?t.touches[0][e]:void 0!==t.changedTouches&&t.changedTouches[0]&&t.changedTouches[0][e]?t.changedTouches[0][e]:0}}class o{constructor(t,e,i,s){this.inputSelector=e,this.focusElement=t,this.container=i,this.input=e?this.focusElement.querySelector(e):null,this.restrictClick=!1,this.isBlurMode=s,this.lock=!1,this.Reset()}OnKeydown(t){32!==t.keyCode&&13!==t.keyCode||this.restrictClick||t.target!==this.focusElement||t.currentTarget!==this.focusElement||(this.lock=!0,this.input.click(),this.focusElement.setAttribute("aria-selected",this.input.checked),this.lock=!1)}OnClickInternal(t){this.onClick&&!this.lock&&this.onClick(this.focusElement)}OnFocusInternal(){this.UpdateStyleMetadata(),this.onFocus&&this.onFocus(this.focusElement)}OnBlurInternal(){this.onBlur&&this.onBlur(this.focusElement)}Reset(){var t;this.events&&this.events.Dispose(),this.events=new s(this),this.input&&(this.input.tabIndex=-1,this.events.AttachEvent(this.input,"focus",(function(){this.input.blur()})),this.events.AttachEvent(this.input,"click",(function(){this.OnClickInternal()})),this.events.AttachEvent(this.focusElement,"keydown",this.OnKeydown)),this.ResetStyleMetadata(),document.activeElement===this.focusElement&&(this.UpdateStyleMetadata(),this.isBlurMode&&this.focusElement.blur()),this.isBlurMode?t=function(){this.focusElement.blur()}:(t=this.OnFocusInternal,this.events.AttachEvent(this.focusElement,"blur",this.OnBlurInternal)),this.events.AttachEvent(this.focusElement,"focus",t),this.events.AttachEvent(this.focusElement,"mousedown",(function(t){t.preventDefault()})),this.restrictClick=!1}Stop(){this.restrictClick=!0}focus(){this.isBlurMode||this.focusElement.focus()}blur(){this.focusElement.blur()}Dispose(){this.events&&this.events.Dispose(),this.events=null,this.focusElement=null,this.input=null}ResetStyleMetadata(){void 0!==this.focusElement.style&&this.focusElement.style&&(this.focusElement.style.removeProperty("--h"),this.focusElement.style.removeProperty("--t"),this.focusElement.style.removeProperty("--bt"))}UpdateStyleMetadata(){if(void 0===this.focusElement.style||!this.focusElement.style||!this.focusElement.style.cssText){var t=g(this.focusElement),e=g(this.container),i=getComputedStyle(this.focusElement)["border-top-width"];this.focusElement.setAttribute("style",`--h:${t.height}px; --t:${t.y-e.y}px; --bt:${i};`)}}}class r{constructor(t,e){this.x=t,this.y=e}clone(){return new r(this.x,this.y)}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}Equal(t){return this.x===t.x&&this.y===t.y}LimitByRectangle(t){var e=Math.min(Math.max(this.y,t.top),t.bottom),i=Math.min(Math.max(this.x,t.left),t.right);return new r(i,e)}IsInRect(t){return t.left<=this.x&&this.x<=t.right&&t.top<=this.y&&this.y<=t.bottom}}class h{constructor(t,e,i,s){this.x=t,this.y=e,this.width=i,this.height=s}clone(){return new h(this.x,this.y,this.width,this.height)}get left(){return this.x}get top(){return this.y}get bottom(){return this.y+this.height}get right(){return this.x+this.width}get size(){return new h(0,0,this.width,this.height)}get location(){return new h(this.x,this.y,0,0)}get center(){return new h(this.x+this.width/2,this.y+this.height/2,0,0)}get scalarLength(){return Math.sqrt(this.x*this.x+this.y*this.y)}Equal(t){return this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height}LimitByRectangle(t){var e=Math.min(Math.max(this.y,t.top),t.bottom),i=Math.min(Math.max(this.x,t.left),t.right);return new h(i,e,0,0)}}function l(){var t=Array.from(arguments),e=[],i=[];t.forEach((function(t){"-"===t||"+"===t?e.push(t):i.push(t)}));for(var s=[];i.length>0;)s.push(i.pop());for(;e.length>0;)s.push(e.shift());for(;s.length>0;){var n=s.shift();e.push("+"===n?a(e.pop(),e.pop()):"-"===n?c(e.pop(),e.pop()):n)}return e.pop()}function a(t,e){var i=u(t),s=u(e);return new h(i.x+s.x,i.y+s.y,i.width+s.width,i.height+s.height)}function c(t,e){var i=u(t),s=u(e);return new h(i.x-s.x,i.y-s.y,i.width-s.width,i.height-s.height)}function u(t){if(t.getBoundingClientRect)return g(t);var e=0,i=0,s=0,n=0;return t.x&&(e=t.x),t.y&&(i=t.y),t.width&&(s=t.width),t.height&&(n=t.height),{x:e,y:i,width:s,height:n}}function g(t){var e=t.getBoundingClientRect();return e&&e.left&&e.top&&!e.x&&!e.y&&(e.x=Math.min(e.left,e.right),e.y=Math.min(e.top,e.bottom)),new h(e.x,e.y,e.width,e.height)}function m(t){var e=g(t),i=getComputedStyle(t),s=d(i.marginLeft),n=d(i.marginRight),o=d(i.marginTop),r=d(i.marginBottom);return new h(e.x-s,e.y-o,e.width+s+n,e.height+o+r)}function d(t){return Math.max(parseFloat(t),0)}const v={DragAndDropUnit:n,FocusUnit:o,rectBlz:h,pointBlz:r,GetClientRect:g,GetClientRectWithMargins:m,geometry:l};export default v;export{n as DragAndDropUnit,o as FocusUnit,g as GetClientRect,m as GetClientRectWithMargins,l as geometry,r as pointBlz,h as rectBlz};
