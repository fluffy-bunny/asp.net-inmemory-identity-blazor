import"./esm-chunk-eaca7b99.js";import{H as e,ae as n}from"./esm-chunk-dac9ea79.js";import"./esm-chunk-e2d38309.js";import{E as t}from"./esm-chunk-e05effe2.js";import{FocusUnit as o,DragAndDropUnit as a,GetClientRect as c,rectBlz as i}from"./esm-dragAndDropUnit-9fa8c743.js";var s,r,u,l,f,d,m,p,v,h,g=null,y=-1,w=-1,x=!0,D=!1;function E(n,o,a,c){if(n.forEach((function(n){e(n)})),l?l._id!==c._id&&(F(l),l=c):l=c,!p)for(var i=p=o;i.parentNode!==document&&i.classList;){if(i.classList.contains("modal-body")){D=!0;break}i=i.parentNode}if(f=new Map,d&&d.Dispose(),d=new t(p),g||(r=new Map,u=new Map,g=n),w=-1,d.AttachEventWithContext(document,"keydown",b,document),g&&(g.sort((function(e,n){return e.dataset.vindex-n.dataset.vindex})),v=function(e,n){if(D)return e;var t=e,o=getComputedStyle(t);for(;o.position!==n&&t.parentNode!==document;)t=t.parentNode,o=getComputedStyle(t);return t}(p,"absolute"),L(a&&!D),k()))var s=d.AttachEvent(v,"focusin",(function(){s.Dispose(),g[0].focus()}));A(),h&&(h.parentNode.removeChild(h),h=null)}function L(e){x=e,m&&m.Dispose();var n=document.querySelector(".column-chooser-exit-button");m=n?new o(n,null,p,!x):null,u.forEach((function(e){e.Dispose()})),u=new Map,g.forEach((function(e){!function(e,n){var t=r.get(e.dataset.column);t||((t=new a(e,e.parentNode,M,".column-chooser-drag-icon-owner",U,D)).onDragStart=R,t.onDrag=B,t.onDragCancel=T,t.onDropAnimationEnd=_,r.set(e.dataset.column,t));t.Reset(),e.classList.remove("up"),e.classList.remove("down"),e.classList.remove("freeze");var c=u.get(e.dataset.column);c||((c=new o(e,".custom-control-input",n,D||!x)).onFocus=C,c.onBlur=O,c.onClick=S,u.set(e.dataset.column,c));c.Reset()}(e,v)}))}function k(){return x}function b(e){switch(k()||(L(!0),9===e.keyCode&&g[g.length-1].focus()),e.keyCode){case 32:w>=0&&(e.preventDefault(),g[w].click());break;case 38:e.preventDefault(),N(-1);break;case 40:e.preventDefault(),N(1)}}function N(e){if(g&&r){w=(w+=e)<0?g.length-1:w;var n=u.get(g[w%=g.length].dataset.column);n&&n.focus()}}function C(e){w=g.indexOf(e)}function O(e){w===g.indexOf(e)&&(w===g.length-1&&m&&m.focus(),w=-1)}function S(e){k()&&L(!1)}function j(e){return g.find((function(n,t,o){return function(e,n){var t=z(e);return!!t&&(t.top<=n&&n<=t.bottom)}(n,e.y)}))}function M(e){var n=j(e);return n?{item:n,relativeRect:z(n)}:null}function A(){if(s&&s.style){var e=r.get(s.dataset.column);e&&e.Reset();var n=u.get(s.dataset.column);n&&n.Reset(),y=-1,s.childNodes.forEach((function(e){e.style&&(e.style.visibility="")})),s=null}}function R(e){y=g.indexOf(s=e),g.forEach((function(e){e.blur(),e!==s&&e.classList.add("freeze")})),s.childNodes.forEach((function(e){e.style&&(e.style.visibility="hidden")}));var n=u.get(s.dataset.column);n&&n.Stop()}function z(e){var n=f.get(e);if(n)return n;var t=c(e),o=U();return n=new i(t.x-o.x,t.y-o.y,t.width,t.height),f.set(e,n),n}function _(e,t){g.forEach((function(e){r.get(e.dataset.column).Stop()})),h=p.cloneNode(!0),n(h),h.style["z-index"]=2e3,p.parentNode.appendChild(h),l.invokeMethodAsync("OnElementsExchange",e.dataset.column,t.dataset.column).catch((function(e){void 0}))}function T(e){g.forEach((function(e){e.classList.remove("up"),e.classList.remove("down"),e.classList.remove("freeze")})),A()}function U(){var e=D?p.parentNode:p,n=c(e);return 0!==e.scrollTop?{x:n.x,y:n.y-e.scrollTop}:n.location}function q(e){u.get(e.dataset.column).UpdateStyleMetadata()}function B(e,n){if(e){-1===y&&(y=g.indexOf(e));var t=j(n.centerOfDraggingObject);if(t){var o=g.indexOf(t),a=!1;g.forEach(y<o?function(e){s===e&&(a=!0),a?(q(e),e.classList.add("up")):e.classList.remove("up","down"),t===e&&(a=!1)}:y>o?function(e){t===e&&(a=!0),a?(q(e),e.classList.add("down")):e.classList.remove("up","down"),s===e&&(a=!1)}:function(e){e.classList.remove("up","down")})}}}function F(e){e._id===l._id&&(r.forEach((function(e){e.Dispose()})),u.forEach((function(e){e.Dispose()})),g=null,s=null,y=-1,p=null,f=null,r=null,u=null,l=null,d&&d.Dispose(),d=null,h&&(h.parentNode.removeChild(h),h=null))}const H={Init:E,Dispose:F};export default H;export{F as Dispose,E as Init};
