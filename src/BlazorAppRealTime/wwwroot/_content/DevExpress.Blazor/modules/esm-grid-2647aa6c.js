import{B as e}from"./esm-chunk-eaca7b99.js";import{x as t,D as l,ab as o,t as n,ad as r,ac as i,aa as a,Q as s,H as u,J as c,r as d,_ as f,K as h,Y as p,B as g}from"./esm-chunk-dac9ea79.js";import{D as m,R as v}from"./esm-chunk-b9f5fab8.js";import{T as y}from"./esm-chunk-e2d38309.js";import"./esm-chunk-6d4715b2.js";import{G as H}from"./esm-chunk-95f069f9.js";var S=".dxbs-table td.table-active",x=".dropdown-item.active",T=".dropdown-item.focused";const w={GroupPanelHead:"gph",ColumnHead:"ch"};function b(e){if(!e.hasAttribute("data-dxdg-draggable"))return null;var t=e.getAttribute("data-dxdg-draggable").split("|"),l=!(t.length>2)||"1"===t[2],o=t.length>1?w[t[1]]:w.ColumnHead,n=o==w.ColumnHead?parseInt(t[0]):-1,r=o==w.GroupPanelHead?parseInt(t[0]):-1,i=e.previousElementSibling;return{columnVisibleIndex:n,groupVisibleIndex:r,columnHeadType:o,canBeGrouped:l,needInsertBeforeToo:!i||!b(i),element:e}}function I(e){return"[data-dxdg-draggable-id="+e+"]"}function R(e,t,l){var o,n,r;o=e,n=N(t,"clientX")-l.left,r=N(t,"clientY")-l.top,void(o.style.transform=["translate(",Math.round(n),"px, ",Math.round(r),"px)"].join(""))}function N(e,t){return void 0!==e[t]?e[t]:void 0!==e.touches?e.touches[0][t]:0}function E(a,s,u){var c=N(a,"clientX"),d=N(a,"clientY"),f=a.target,h=!1,p=function(e){var a=Math.abs(c-N(e,"clientX"))>10,p=Math.abs(d-N(e,"clientY"))>10;return(a||p)&&(h=!0,g(),function(e,a,s,u){var c=I(s),d=o(a,c);if(!d)return;var f=n(d,"dxbs-gridview").getBoundingClientRect(),h=b(d),p=i(),g=r(),m={left:0,top:0},v=function(e,t){for(var l=[],o=I(t),n=document.querySelectorAll(o),r=!1,i=!1,a=0;a<n.length;a++){var s=n[a],u=s.getBoundingClientRect(),c=b(s),d=c.columnVisibleIndex,f=c.groupVisibleIndex,h=c.columnHeadType;h==w.GroupPanelHead?r=!0:h==w.ColumnHead&&(i=!0),c.needInsertBeforeToo&&l.push(new q(s,u.left,u.top,u.bottom,d,f,h,!0,!1)),l.push(new q(s,u.right,u.top,u.bottom,d,f,h,!1,!1))}if(r||i){if(!r){var p=document.querySelector("[data-dxdg-drag-group-panel="+t+"]");if(p){u=p.getBoundingClientRect();l.push(new q(p,u.left,u.top,u.bottom,-1,0,w.GroupPanelHead,!1,!0,!0))}}if(!i){var g=document.querySelector("[data-dxdg-drag-head-row="+t+"]");if(g){u=g.getBoundingClientRect();l.push(new q(g,u.right,u.top,u.bottom,-1,-1,w.ColumnHead,!1,!0,!0))}}}return l}(0,s),H=function(e,t){var l=e.cloneNode(!0),o=e.getBoundingClientRect(),n={left:N(t,"clientX")-o.left,top:N(t,"clientY")-o.top};if("DIV"!=l.tagName){var r=document.createElement("DIV"),i=window.getComputedStyle(e);r.innerHTML=l.innerHTML,r.className="card "+e.className,r.style.width=o.width+"px",r.style.height=o.height+"px",r.style.paddingTop=i.paddingTop,r.style.paddingBottom=i.paddingBottom,r.style.paddingLeft=i.paddingLeft,r.style.paddingRight=i.paddingRight,l=r}else l.style.width=o.width+"px",l.style.height=o.height+"px";l.className=l.className+" dx-dragging-state",document.body.appendChild(l);var a=l.getBoundingClientRect();return{dragElement:l,offsetFromMouse:{left:a.left+n.left,top:a.top+n.top}}}(d,e),S=H.dragElement,x=H.offsetFromMouse;R(S,e,x);var T=!0,E=null,C=function(e){return T&&(S.style.visibility="visible",T=!1),R(S,e,{left:x.left+m.left,top:x.top+m.top}),E=function(e,t,l,o,n,a){!function(e){for(var t=I(e),l=document.querySelectorAll("div.dxgv-target-marks"+t),o=0;o<l.length;o++){var n=l[o];n.parentNode.removeChild(n)}}(t);for(var s=null,u=[],c=N(o,"clientX"),d=N(o,"clientY"),f=0;f<e.length;f++){var h=e[f];if(h.columnHeadType!=w.GroupPanelHead||l.canBeGrouped)if(h.top+n.top<=d&&d<=h.bottom+n.top){if(h.wholeRowIsRarget){s=h;break}u.push({distance:Math.abs(Math.abs(h.x+n.left)-Math.abs(c)),target:h})}}if(null==s){var p=1e6;for(var f in u)p>u[f].distance&&V(c,l,u[f].target)&&(p=u[f].distance,s=u[f].target)}null==s||B(l,s)||s.x>=a.left&&s.x<=a.right&&!function(e,t){var l=document.createElement("DIV");l.className="dxgv-target-marks",l.dataset.dxdgDraggableId=t,l.style.top=e.top+(e.docScrollTop-r())+r()-1-1+"px",l.style.height=e.bottom-e.top+2+"px",l.style.left=e.x+(e.docScrollLeft-i())+i()+"px",l.innerHTML=["<span class='oi oi-arrow-bottom' aria-hidden='true'></span>","<div style='height:",l.style.height,"'></div>","<span class='oi oi-arrow-top' aria-hidden='true'></span>"].join(""),document.body.appendChild(l),e.mark=l}(s,t);return s}(v,s,h,e,m,f),e.preventDefault(),!1},M=function(){E&&!B(h,E)&&(u.invokeMethodAsync("OnGridColumnHeadDragNDrop",h.columnHeadType==w.GroupPanelHead?h.groupVisibleIndex:h.columnVisibleIndex,h.columnHeadType,E.columnHeadType==w.GroupPanelHead?E.groupVisibleIndex:E.columnVisibleIndex,E.columnHeadType,E.insertBefore),E.mark&&E.mark.parentNode.removeChild(E.mark));l(document,y.touchMouseMoveEventName,C),l(document,y.touchMouseUpEventName,M),l(window,"scroll",D),S.parentNode.removeChild(S)},D=function(){m={left:p-i(),top:g-r()}};t(document,y.touchMouseMoveEventName,C),t(document,y.touchMouseUpEventName,M),t(window,"scroll",D)}(e,f,s,u)),e.preventDefault(),!1},g=function(){l(document,y.touchMouseMoveEventName,p),l(document,y.touchMouseUpEventName,g),!h&&f&&e.WebKitTouchUI&&f.click()};return t(document,y.touchMouseMoveEventName,p),t(document,y.touchMouseUpEventName,g),a.preventDefault(),f.focus(),!1}function q(e,t,l,o,n,a,s,u,c){this.element=e,this.x=t,this.top=l,this.bottom=o,this.columnVisibleIndex=n,this.groupVisibleIndex=a,this.columnHeadType=s,this.insertBefore=u,this.wholeRowIsRarget=c,this.docScrollTop=r(),this.docScrollLeft=i()}function B(e,t){function l(e,t){return t.groupVisibleIndex==e.groupVisibleIndex||t.groupVisibleIndex==e.groupVisibleIndex-1&&!t.insertBefore}function o(e,t){return t.columnVisibleIndex==e.columnVisibleIndex||t.columnVisibleIndex==e.columnVisibleIndex-1&&!t.insertBefore}return!(t.columnHeadType!=e.columnHeadType||e.columnHeadType!=w.GroupPanelHead||!l(e,t))||(!(t.columnHeadType!=e.columnHeadType||e.columnHeadType!=w.ColumnHead||!o(e,t))||(!(e.columnHeadType!=w.GroupPanelHead||t.columnHeadType!=w.ColumnHead||-1==e.columnVisibleIndex||!o(e,t))||!(e.columnHeadType!=w.ColumnHead||t.columnHeadType!=w.GroupPanelHead||-1==e.groupVisibleIndex||!l(e,t))))}function V(e,t,l){var o=t.element.getBoundingClientRect();if(B(t,l)&&(e<o.left||e>o.right))return!1;if(l.x<o.left){if(e>o.right)return!1}else if(e<o.left)return!1;return!0}w[1]=w.ColumnHead,w[0]=w.GroupPanelHead;class C{constructor(e,t,l){this._itemHeight=e,this._scrollTop=t,this._scrollHeight=l}get itemHeight(){return this._itemHeight}get scrollTop(){return this._scrollTop}get scrollHeight(){return this._scrollHeight}isEqual(e){return this.itemHeight===e.itemHeight&&this.scrollTop===e.scrollTop&&this.scrollHeight===e.scrollHeight}}function M(e){if(a(e)){if(!(t=function(e){var t=e.querySelector("*[id$='_LB']");t||(t=e.parentNode.querySelector("*[id$='_LB']"));t||(t=e);if(t){var l=t.querySelector(x);if(l||(l=t.querySelector(S)),l)return l.parentNode}return null}(e)))var t=function(e){var t=null;s(e,(function(l){t=e.querySelector("*"+l+" > *[id$='_LB']")})),t||s(e.parentNode,(function(l){t=e.parentNode.querySelector("*"+l+" > *[id$='_LB']")}));var l=t?t.querySelector(S):null;return l?l.parentNode:null}(e);if(t){var l=e,o=t.offsetTop;if("TABLE"==t.offsetParent.tagName){var n=t.offsetParent.previousElementSibling;n&&(o+=n.clientHeight)}var r=l.scrollTop+l.clientHeight<o+t.offsetHeight;l.scrollTop>o&&(l.scrollTop=o),r&&(l.scrollTop=o-(l.clientHeight-t.offsetHeight))}}}function D(e){if(a(e)){var t=function(e){var t=e.querySelector("*[id$='_LB']");t||(t=e.parentNode.querySelector("*[id$='_LB']"));t||(t=e);if(t){var l=t.querySelector(T);if(l)return"TR"==l.tagName?l:l.parentNode}return null}(e);if(t){var l=e.querySelector(".dxgvCSD");l||(l=e);var o=l.scrollTop+l.clientHeight<t.offsetTop+t.offsetHeight;l.scrollTop>t.offsetTop&&(l.scrollTop=t.offsetTop),o&&(l.scrollTop=t.offsetTop-(l.clientHeight-t.offsetHeight))}}}function L(e){void 0===e.dataset.virtualScrollLock&&(e.dataset.virtualScrollLock=0)}function k(e){L(e),e.dataset.virtualScrollLock++}function A(e){L(e),e.dataset.virtualScrollLock--}function G(e,t,l,o,n,r,i){l.isHorizontalScrolling&&!function(e,t,l){if(t.scrollLeft===l.scrollLeft)return;var o=g(e);o===t?l.scrollLeft=t.scrollLeft:o===l&&window.setTimeout(()=>t.scrollLeft=l.scrollLeft,0)}(e,o,n),l.isVirtualScrolling&&function(e,t,l,o,n){if(r=l,L(r),r.dataset.virtualScrollLock>0)return;var r;!function(e,t,l,o,n){var r=!0;l.dataset.prevScrollTop?r=l.dataset.prevScrollTop!==l.scrollTop.toString():l.dataset.prevScrollTop=l.scrollTop;P(l),r&&(l.dataset.OnScrollTimerId=window.setTimeout((function(){!function(e,t,l,o,n){var r=W(t),i=U(t,n),a=i.scrollTop,s=i.scrollBottom,u=o.clientHeight>0&&s>l.offsetHeight+r.offsetHeight;(l.clientHeight>0&&a<l.offsetHeight||u)&&!function(e,t,l){if(e.dxScrollStateCache&&e.dxScrollStateCache.isEqual(l))return;e.dxScrollStateCache=l,t.DxRestoreScrollTop=t.scrollTop,k(t),e.invokeMethodAsync("OnGridVirtualScroll",l.itemHeight,l.scrollTop,l.scrollHeight).then(l=>{!function(e,t){e.dotNetComponentReference=t,K(e)}(l,e),A(t)}).catch(j)}(e,t,i.requestScrollState)}(e,l,o,n,!1),t.needInternalSettings&&$(t)}),200))}(e,t,l,o,n)}(t,l,o,r,i)}function P(e){e.dataset.OnScrollTimerId&&(clearTimeout(e.dataset.OnScrollTimerId),delete e.dataset.OnScrollTimerId)}function W(e){var t=e.querySelector("table.dxbs-table"),l=e.parentNode.querySelector("div.dxbs-listbox > ul");return t||l}function _(e,t,l,o,n){var r=W(t),i=function(e,t){var l=O(e);return{itemHeight:l,spacerTop:t.virtualScrollingOptions.itemsAbove*l,spacerBelow:t.virtualScrollingOptions.itemsBelow*l}}(r,n);l.style.height=i.spacerTop+"px",o.style.height=i.spacerBelow+"px",function(e,t,l,o){if(e.clientHeight>t.offsetHeight)return;e.scrollTop<l.clientHeight&&(e.scrollTop=l.clientHeight+1);e.scrollTop+e.clientHeight>l.clientHeight+t.offsetHeight&&(e.scrollTop=l.clientHeight+t.offsetHeight-e.clientHeight-1)}(t,r,l)}function O(e){for(var t=function(e){var t=[];return e.dataset.tempUniqueId="tempUniqueId","TABLE"===e.tagName?t=e.parentNode.querySelectorAll("TABLE[data-temp-unique-id] > TBODY > TR"):"UL"===e.tagName&&(t=e.parentNode.querySelectorAll("ul[data-temp-unique-id] > li")),delete e.dataset.tempUniqueId,t}(e),l={},o=0;o<t.length;o++){var n=t[o];l[n.offsetHeight]=l[n.offsetHeight]?l[n.offsetHeight]+1:1}var r=0,i=0;for(var a in l)l[a]>i&&(i=l[a],r=a);return Number.parseInt(r)}function X(e){return null!==W(e)}function U(e,t){var l=300,o=300;t&&(l=0,o=0);var n=W(e),r=e.scrollTop-l;r<0&&(r=0);var i=e.scrollTop+e.clientHeight+o,a=r-l;a<0&&(a=0);var s=i-a+o,u=O(n);return{scrollTop:r,scrollBottom:i,requestScrollState:new C(u,a,s)}}function j(e){e&&e.mainElement&&J(e.mainElement)}function z(e,t){return(t.isVerticalScrolling||t.isVirtualScrolling)&&(e.clientHeight<e.scrollHeight||"scroll"==e.style.overflowY)}function Y(e){return function(){if(e.ownerStyleSheet){var t=e.parentStyleSheet,l=Array.prototype.indexOf.call(t.cssRules,e);l>-1&&t.deleteRule(l)}}}function $(e){var t=e.elementsStorage,l=u(e.mainElement).parentElement;if(!l)return;var o=u(t.scrollElement),r=u(t.scrollHeaderElement),i=[];if(!o.style.maxHeight){var a=window.getComputedStyle(l);if(!a)return;let t=parseInt(a.borderTopWidth,10)+parseInt(a.borderBottomWidth,10);if(e.isDropDown){let e=parseInt(a.maxHeight,10)-t;o.style.maxHeight=e-r.offsetHeight+"px"}else{let e=f(l,e=>{o.style.maxHeight=e.height-r.offsetHeight+"px"}),t=f(r,e=>{o.style.maxHeight=l.clientHeight-(e.height+2*h(r))+"px"});i.push((function(){p(e),p(t)})),o.style.maxHeight=l.clientHeight-r.offsetHeight+"px"}}function s(e,t){var l=e.querySelector(t);return l?l.children:null}let c=!0;if(l.dataset.calculated&&(c=e.isVirtualScrolling),c&&e.isDropDown&&2!=e.dropDownWidthMode){var g=o.querySelector("table"),m=r.querySelector("table");if(!g||!m)return;var v=s(g,"tbody>tr");let t=v&&1==v.length&&g.querySelector("tr.dxbs-empty-data-row");var y=s(m,"colgroup"),H=s(g,"colgroup");if(t)m.style.width="auto",g.style.width=window.getComputedStyle(m).width;else{var S=s(m,"thead>tr");if(!(y&&S&&v&&H))return;g.style.width=m.style.width="auto";let t=[];for(let l=0;l<y.length;l++)if(y[l].style.width)if(-1!=y[l].style.width.indexOf("%"))t.push(l);else{let t=d();var x=u(e.mainElement).getAttribute("data-dxdg-id"),T=null;t&&(t.insertRule("[data-dxdg-id='"+x+"'] table tr>td:nth-child("+(l+1)+"), [data-dxdg-id='"+x+"'] table tr>th:nth-child("+(l+1)+") { max-width:"+y[l].style.width+"; }",t.cssRules.length),T=t.cssRules[t.cssRules.length-1]),i.push(Y(T))}else y[l].dataset.autoWidth=!0,F(y[l],H[l],S[l],v[l]);if(t.length>0)for(let e=0;e<t.length;e++)F(y[e],H[e],S[e],v[e])}if(0==e.dropDownWidthMode){let e=n(l,"dx-blazor-multicolumn-editor");e&&e.offsetWidth>=l.offsetWidth&&(!function(e,t,l,o){e.style.width=null,t.style.width=null;for(let e=0;e<l.length;e++)if(l[e].dataset.autoWidth&&(l[e].style.width=null,o)){let t=o.item(e);t&&(t.style.width=null)}}(m,g,y,H),l.style.width=e.offsetWidth+"px")}l.dataset.calculated=!0}return i.length>0?function(){i.forEach(e=>e())}:null}function F(e,t,l,o){var n=l.offsetWidth,r=o.offsetWidth;n>r?t.style.width=e.style.width=n+"px":n<r&&(t.style.width=e.style.width=r+"px")}function K(e){var o=u(e.mainElement);if(o){var n=e.dotNetComponentReference,r=e.scrollToSelectedItemRequested,i=e.elementsStorage,a=u(i.scrollElement),s=u(i.scrollHeaderElement),f=u(i.virtualScrollSpacerTopElement),h=u(i.virtualScrollSpacerBottomElement);o=u(o),m(o);var p=null,g=null,S=null,x=null,T=null;e.needInternalSettings&&(T=$(e)),a=u(a);var w=null;a&&(s=u(s),k(a),e.isVirtualScrolling&&(f=u(f),h=u(h)),(e.isVirtualScrolling||e.isVerticalScrolling)&&function(e,t,l){if((l.isVerticalScrolling||l.isVirtualScrolling)&&t){var o=[t];if(z(e,l)){var n=H();if(17!==n||l.isHorizontalScrolling)for(var r=l.isHorizontalScrolling?"paddingRight":"marginRight",i=l.isHorizontalScrolling?"marginRight":"paddingRight",a=0,s=o.length;a<s;a++)o[a].style[r]="0",o[a].style[i]=n+"px";else e.style.paddingRight="",e.style.marginRight="",t.style.paddingRight="",t.style.marginRight=""}else e.style.paddingRight="0",e.style.marginRight="0",t.style.paddingRight="0",t.style.marginRight="0"}}(a,s,e),e.isVirtualScrolling&&(_(0,a,f,h,e),r?M(a):a.DxRestoreScrollTop&&(a.scrollTop=a.DxRestoreScrollTop,delete a.DxRestoreScrollTop)),w=function(e){for(var t=e.querySelectorAll(".btn.btn-toggle"),l=0,o=0;o<t.length;o++){var n=t[o],r=n.offsetWidth+c(n.parentNode);if(r>0){l=r;break}}var i=d(),a=e.getAttribute("data-dxdg-id"),s=null;return i&&(i.insertRule("[data-dxdg-id='"+a+"'] > col.dxbs-grid-cols-togglebtn { width:"+l+"px !important; }",i.cssRules.length),s=i.cssRules[i.cssRules.length-1]),Y(s)}(o),t(a,"scroll",p=function(t){return G(t,n,e,a,s,f,h)}),s&&t(s,"scroll",p),A(a),function(e){return!e.needInternalSettings&&(e.isHorizontalScrolling||e.isVerticalScrolling)}(e)&&((g=function(){!function(e,t,l,o,n,r){if(t){k(t);var i=t.style.overflowX;t.style.overflowX="hidden",t.style.width="0"}if(l){var a=l.style.overflowX;l.style.overflowX="hidden",l.style.width="0"}var s=e.clientWidth;if(t&&(s&&(t.style.width=s+"px"),t.style.overflowX=i),l){var u=z(t,r)?H():0;s&&(l.style.width=s-u+"px"),l.style.overflowX=a}t&&A(t)}(o,a,s,0,0,e)})(),t(window,"resize",g)));var b=null,I=null;if(e.isColumnDragEnabled){var R=o.dataset.dxdgId;R&&((b=o.querySelector("[data-dxdg-drag-head-row='"+R+"']"))&&t(b,y.touchMouseDownEventName,S=function(e){return E(e,R,n)}),(I=o.querySelector("[data-dxdg-gp='"+R+"']"))&&t(I,y.touchMouseDownEventName,x=function(e){return E(e,R,n)}))}return v(o,(function(){w&&w(),T&&T(),p&&(l(a,"scroll",p),s&&l(s,"scroll",p)),g&&l(window,"resize",g),a&&P(a),S&&b&&l(b,y.touchMouseDownEventName,S),x&&I&&l(I,y.touchMouseDownEventName,x)})),Promise.resolve("ok")}}function J(e){return(e=u(e))&&m(e),Promise.resolve("ok")}const Q={Init:K,Dispose:J};export default Q;export{J as Dispose,U as GetParametersForVirtualScrollingRequest,X as HasParametersForVirtualScrollingRequest,K as Init,D as ScrollToFocusedItem,M as ScrollToSelectedItem};
